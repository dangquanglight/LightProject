<?php	$file = getcwd() . "/" . APPPATH . "controllers/MY_controller.php";			include $file;	class Fsadfzerrwez_sub_types extends Fsadfzerrwez_home{		function Fsadfzerrwez_sub_types(){					parent::__construct();				$this->load->model("sub_type");			$this->load->model("device");		}				/***********************************************************************/		/**************************** START SUB TYPES *******************************/				/***********************************************************************/				function sub_types(){			$this->check_login();						$this->check_role(MODULE_SUB_TYPES, MODULE_TYPE_VIEW);			$data = $this->get_sub_types();			$this->load->model('type');			$data['types'] = $this->type->get_all_types();			$data['types-url'] = get_back_url(base_url("types"), MODULE_TYPES);			$this->load_page('sub-types', $this->lang->line('sub-types'), $data);		}				function ajax_sub_types(){						$this->check_login_ajax();			$this->check_role_ajax(MODULE_SUB_TYPES, MODULE_TYPE_VIEW);			$data = $this->get_sub_types();			$model['data'] = $data;			$model['controller_name'] = $this->controller_name;			$this->load->view($this->home_directory . "sub-types-table", $model);		}				private function get_sub_types(){			$data = $this->get_page_config();				$type_id = $this->input->get('type_id');			$sort_by = $this->input->get('sort_by');			$ascending = $this->input->get('ascending');						$query = $this->sub_type->get_sub_types($data['keywords'], $type_id, $data['page'], $data['page_size'], $sort_by, $ascending, $num_rows, get_language());			$this->set_paging_data($data, $query, $num_rows);			$data['type_id'] = $type_id;			return $data;		}				function get_units_by_sub_types($id){			$this->check_login();			$this->load->model('unit');			$query = $this->unit->get_units_by_sub_type($id);			$data = array();			foreach($query->result() as $row){				$data[] = array($row->id, $row->unit_name);			}						echo json_encode($data);		}						function add_sub_type($id = null){										$this->check_login();			$this->check_role(MODULE_SUB_TYPES, MODULE_TYPE_VIEW);			$result = null;			$sub_type = null;				$err_msg = '';			$data = array();
			$data['back-url'] = get_back_url(base_url("sub-types"), MODULE_SUB_TYPES);			if (is_post()){									$result = false;				$sub_type = $this->sub_type->get_post_data();								$this->form_validation->set_rules('sub_type_name', $this->lang->line('required-sub-type-name'), 'trim|required');				$this->form_validation->set_rules('type_id', $this->lang->line('required-select-type'), 'trim|required');				if ($this->form_validation->run() == TRUE){										//UPDATE CASE						if ($id){						$this->check_role(MODULE_SUB_TYPES, MODULE_TYPE_UPDATE);												$result = $this->sub_type->update($sub_type, $id);						if ($result){							$err_msg = get_saved_message('sub-type', $sub_type->sub_type_name);							if ($this->input->post('save_and_continue') == false){																$this->set_flashdata($err_msg);								redirect($data['back-url']);							}						}							else{							$err_msg = get_saved_fail_message('sub-type', $sub_type->sub_type_name);						}					}					else{						$this->check_role(MODULE_SUB_TYPES, MODULE_TYPE_ADD);												$result = $this->sub_type->insert($sub_type, get_user_id());												if ($result){								$err_msg = get_saved_message('sub-type', $sub_type->sub_type_name);							if ($this->input->post('save_and_continue') == true){								//clear old data								$sub_type->clear_data();							}							else{																$this->set_flashdata($err_msg);								redirect($data['back-url']);							}						}						else{							$err_msg = get_saved_fail_message('sub-type', $sub_type->sub_type_name);						}											}				}				else{					$err_msg = $this->lang->line('required-sub-type');				}			}			else{								if ($id){										$sub_type = $this->sub_type->get_id($id);									}				else{										$sub_type = new sub_type();				}			}			$this->load->model('type');			$this->load->model('unit');			$data['types'] = $this->type->get_all_types();			$data['err_msg'] = $err_msg;			$data['result'] = $result;									$data['data'] = $sub_type;			$data['id'] = $id;						$data['page'] = $this->input->get('page');			$data['page_size'] = $this->input->get('page_size');			$data['keywords'] = $this->input->get('keywords');			$data['units'] = $this->unit->get_all_units();			$title_page = $this->lang->line('sub-type');			if (!$sub_type){				$title_page = get_not_found_short();			}			$this->load_page('add-sub-type', $title_page, $data);		}				function active_sub_types(){						$this->check_login_ajax();						$this->check_role_ajax(MODULE_SUB_TYPES, MODULE_TYPE_UPDATE);			$active = $this->input->post('active');						$ids = $this->get_array_ids();									$this->sub_type->active_in($active, $ids);		}				function delete_sub_types(){			$this->check_login_ajax();			$this->check_role_ajax(MODULE_SUB_TYPES, MODULE_TYPE_DELETE);			$ids = $this->get_array_ids();			$this->sub_type->delete_in($ids);		}		/***********************************************************************/		/**************************** END OF SUB TYPES *******************************/				/***********************************************************************/			}?>