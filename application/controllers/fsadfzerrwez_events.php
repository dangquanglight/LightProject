<?php	$file = getcwd() . "/" . APPPATH . "controllers/MY_controller.php";			include $file;	class Fsadfzerrwez_events extends Fsadfzerrwez_home{		function Fsadfzerrwez_events(){					parent::__construct();				$this->load->model("event");			$this->load->model("event_ref");			$this->load->model("device");		}				/***********************************************************************/		/**************************** START EVENTS *******************************/				/***********************************************************************/				function events(){			$this->check_login();						$this->check_role(MODULE_EVENTS, MODULE_TYPE_VIEW);			$data = $this->get_events();			$this->load_page('events', $this->lang->line('events'), $data);		}				function ajax_events(){						$this->check_login_ajax();			$this->check_role_ajax(MODULE_EVENTS, MODULE_TYPE_VIEW);			$data = $this->get_events();			$model['data'] = $data;			$model['controller_name'] = $this->controller_name;			$this->load->view($this->home_directory . "events-table", $model);		}				private function get_events(){			$data = $this->get_page_config();				$sort_by = $this->input->get('sort_by');			$ascending = $this->input->get('ascending');			$company_id = get_company_id();			$query = $this->event_ref->get_events($company_id, $data['page'], $data['page_size'], $sort_by, $ascending, $num_rows, get_language());			$this->set_paging_data($data, $query, $num_rows);									return $data;		}				function add_event($ref_id = null){										$this->check_login();			$this->check_role(MODULE_EVENTS, MODULE_TYPE_VIEW);			$result = null;						$company_id = get_company_id();			$err_msg = '';						$id = null;			$ref_event = $this->event_ref->get_id($ref_id, $company_id);			if ($ref_event){				$id = $ref_event->ref_id;			}						$event = new stdClass();			$data = array();
			$data['back-url'] = get_back_url(base_url("events"), MODULE_EVENTS);			if (is_post()){					$user_id = get_user_id();				$result = false;				$event = $this->event->get_post_data();				//UPDATE CASE					if ($id){					$this->check_role(MODULE_EVENTS, MODULE_TYPE_UPDATE);										$result = $this->event->update($event, $id, $company_id );					if ($result){						$event_ref = $this->event_ref->get_post_data();						//update time based						$this->event_ref->update($event_ref, $ref_id, $company_id);												$err_msg = get_saved_message('event', $event->name);						if ($this->input->post('save_and_continue') == false){															$this->set_flashdata($err_msg);							redirect($data['back-url']);						}						else{							add_form_error('', $err_msg);							add_form_error('result', true);						}					}						else{						add_form_error('', get_saved_fail_message('event', $event->name));					}									}				else{					$this->check_role(MODULE_EVENTS, MODULE_TYPE_ADD);										$result = $this->event->insert($event, $company_id, $user_id);											if ($result){								$event_ref = $this->event_ref->get_post_data();						$event_ref->ref_id = $this->db->insert_id();						//set condition base						$event_ref->event_type = 1;						$this->event_ref->insert($event_ref, $company_id, $user_id);												$err_msg = get_saved_message('event', $event->name);						if ($this->input->post('save_and_continue') == true){							add_form_error('', $err_msg);							add_form_error('result', true);							//clear old data							$event->clear_data();						}						else{							$this->set_flashdata($err_msg);							redirect($data['back-url']);						}					}					else{						add_form_error('', get_saved_fail_message('event', $event->name));					}									}			}			else{				if ($id){					//LOAD EVENT					$event = $this->event->get_id($id, $company_id);									}				else{					$event = new event();				}							}			$data['data'] = $event;			$data['devices'] = $this->device->get_all_devices_4_rand_import($company_id);			$data['err_msg'] = $err_msg;			$data['result'] = $result;			$data['id'] = $id;			$title_page = $this->lang->line('event');			$this->load_page('add-event', $title_page, $data);		}				function active_events(){						$this->check_login_ajax();			$this->check_role_ajax(MODULE_EVENTS, MODULE_TYPE_UPDATE);			$active = $this->input->post('active');						$ids = $this->get_array_ids();									$this->event_ref->active_in($active, $ids, get_company_id());		}				function delete_events(){			$this->check_login_ajax();			$this->check_role_ajax(MODULE_EVENTS, MODULE_TYPE_DELETE);			$this->check_login();									$ids = $this->get_array_ids();									$this->event_ref->delete_in($ids, get_company_id());		}				/***********************************************************************/		/**************************** END OF EVENTS *******************************/				/***********************************************************************/			}?>