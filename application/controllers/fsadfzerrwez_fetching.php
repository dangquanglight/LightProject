<?php	$file = getcwd() . "/" . APPPATH . "controllers/MY_controller.php";			include $file;	class Fsadfzerrwez_fetching extends Fsadfzerrwez_home{		function Fsadfzerrwez_fetching(){					parent::__construct();				$this->load->model("zone");				$this->load->model('layout');		}				/***********************************************************************/		/**************************** START FETCHING *******************************/				/***********************************************************************/				function fetch_camera(){			$root_dir =  FTP_IMAGES_ROOT;			$this->load->model('measurement');			$this->db->trans_start();			$this->fetch_companies($root_dir);			$this->db->trans_complete();		}				function fetch_companies($root_dir){			//OPEN COMPANIES DIRECTORIES			if ($handle = opendir($root_dir)) {				while (false !== ($entry = readdir($handle))) {										if ($entry != "." && $entry != "..") {												$root_inner = $root_dir . $entry . '/';						if (is_dir($root_inner)){							echo 'COMPANY: ' . $entry . '<br/>';							$this->fetch_sites($root_inner, $entry);						}					}				}				closedir($handle);			}		}				function fetch_sites($root_dir, $company_entry){			//OPEN COMPANIES DIRECTORIES			if ($handle = opendir($root_dir)) {				while (false !== ($entry = readdir($handle))) {										if ($entry != "." && $entry != "..") {												$root_inner = $root_dir . $entry . '/';						if (is_dir($root_inner)){							echo '----SITE: ' . $entry . '<br/>';							$this->fetch_zones($root_inner, $company_entry, $entry);						}					}				}				closedir($handle);			}		}				function fetch_zones($root_dir, $company_entry, $site_entry){			//OPEN COMPANIES DIRECTORIES			if ($handle = opendir($root_dir)) {				while (false !== ($entry = readdir($handle))) {										if ($entry != "." && $entry != "..") {												$root_inner = $root_dir . $entry . '/';						if (is_dir($root_inner)){							echo '-------ZONE: ' . $entry . '<br/>';							$this->fetch_devices($root_inner, $company_entry, $site_entry, $entry);						}					}				}				closedir($handle);			}		}				function fetch_devices($root_dir, $company_entry, $site_entry, $zone_entry){			//OPEN COMPANIES DIRECTORIES			if ($handle = opendir($root_dir)) {				while (false !== ($entry = readdir($handle))) {										if ($entry != "." && $entry != "..") {												$root_inner = $root_dir . $entry . '/';						if (is_dir($root_inner)){							echo '----------DEVICE: ' . $entry . '<br/>';							//echo $root_inner . '<br/>';							$this->fetch_images($root_inner, $company_entry, $site_entry, $zone_entry, $entry);						}					}				}				closedir($handle);			}		}				function fetch_images($root_dir, $company_entry, $site_entry, $zone_entry, $device_entry){			//OPEN COMPANIES DIRECTORIES			if ($handle = opendir($root_dir)) {				while (false !== ($entry = readdir($handle))) {										if ($entry != "." && $entry != "..") {												$root_inner = $root_dir . $entry;						if (is_file($root_inner)){							//echo '------------IMAGE: ' . $entry . '<br/>';							$this->process_image($entry, $company_entry, $site_entry, $zone_entry, $device_entry);						}					}				}				closedir($handle);			}		}				private function process_image($file_name, $company_id, $site_id, $zone_id, $device_id){			//echo '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZONE: ' . $zone_entry . '<br/>';														//echo $zone_entry . '<br/>';			preg_match("/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/", $file_name, $data);			//var_dump($data);			if (count($data) == 7){				$datetime = $data[1] . '-' . $data[2] . '-' . $data[3] . ' ' . $data[4] . ':' . $data[5] . ':' . $data[6];				echo $datetime . '<br/>';				$this->measurement->insert_or_update_image($company_id, $device_id, $datetime, $file_name);			}		}				/***********************************************************************/		/**************************** END OF FETCHING *******************************/				/***********************************************************************/			}?>